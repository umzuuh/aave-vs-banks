<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aave vs Banks</title>
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Aave vs Banks - DeFi Protocol Breaks into Top 40 U.S. Banks">
    <meta property="og:description" content="Aave, a decentralized finance protocol, has broken into the top 40 U.S. banks by deposit size. See how DeFi compares to traditional banking institutions.">
    <meta property="og:type" content="website">
    <meta property="og:url" content=".">
    <meta property="og:image" content=".">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Aave vs Banks - DeFi Protocol Ranking Among Top U.S. Banks">
    <meta property="og:site_name" content="Aave vs Banks">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Aave vs Banks - DeFi Protocol Breaks into Top 40 U.S. Banks">
    <meta name="twitter:description" content="Aave, a decentralized finance protocol, has broken into the top 40 U.S. banks by deposit size. See how DeFi compares to traditional banking institutions.">
    <meta name="twitter:image" content=".">
    <meta name="twitter:image:alt" content="Aave vs Banks - DeFi Protocol Ranking Among Top U.S. Banks">
    
    <!-- Additional Meta Tags -->
    <meta name="description" content="Aave, a decentralized finance protocol, has broken into the top 40 U.S. banks by deposit size. See how DeFi compares to traditional banking institutions.">
    <meta name="keywords" content="Aave, DeFi, decentralized finance, banking, cryptocurrency, blockchain, traditional banks, Federal Reserve, deposits, TVL">
    <meta name="author" content="Aave vs Banks">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjY2IiBoZWlnaHQ9IjEzOSIgdmlld0JveD0iMCAwIDI2NiAxMzkiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik05Ny41NDE4IDEzOC41MzNDMTEyLjQ2MSAxMzguNTMzIDEyNC41NTYgMTI2LjQzOCAxMjQuNTU2IDExMS41MThDMTI0LjU1NiA5Ni41OTg3IDExMi40NjEgODQuNTAzOSA5Ny41NDE4IDg0LjUwMzlDODIuNjIyMSA4NC41MDM5IDcwLjUyNzMgOTYuNTk4NyA3MC41MjczIDExMS41MThDNzAuNTI3MyAxMjYuNDM4IDgyLjYyMjEgMTM4LjUzMyA5Ny41NDE4IDEzOC41MzNaIiBmaWxsPSIjMDAwMDAwIi8+CjxwYXRoIGQ9Ik0xNjguMTQ5IDEzOC41MzNDMTgzLjA2OSAxMzguNTMzIDE5NS4xNjQgMTI2LjQzOCAxOTUuMTY0IDExMS41MThDMTk1LjE2NCA5Ni41OTg3IDE4My4wNjkgODQuNTAzOSAxNjguMTQ5IDg0LjUwMzlDMTUzLjIzIDg0LjUwMzkgMTQxLjEzNSA5Ni41OTg3IDE0MS4xMzUgMTExLjUxOEMxNDEuMTM1IDEyNi40MzggMTUzLjIzIDEzOC41MzMgMTY4LjE0OSAxMzguNTMzWiIgZmlsbD0iIzAwMDAwMCIvPgo8cGF0aCBkPSJNMTMyLjggMEM1OS40NDk3IDAgLTAuMDE5MTk1NCA2MC42MDE3IDQuNjQ3ODZlLTA2IDEzNS4zMzVIMzMuOTI2NEMzMy45MjY0IDc5LjMyODEgNzcuODQzMyAzMy45MiAxMzIuOCAzMy45MkMxODcuNzU3IDMzLjkyIDIzMS42NzQgNzkuMzI4MSAyMzEuNjc0IDEzNS4zMzVIMjY1LjZDMjY1LjYxMyA2MC42MDE3IDIwNi4xNDQgMCAxMzIuOCAwWiIgZmlsbD0iIzAwMDAwMCIvPgo8L3N2Zz4K">
    <style>
        body {
            background-color: #9896FF;
            color: white;
            font-family: "Inter", sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
        }
        
        .container {
            max-width: 960px;
            width: 100%;
        }
        
        h1 {
            color: white;
            margin-bottom: 8px; /* Decrease spacing between title and data sources */
            padding-left: 24px;
            padding-right: 24px;
        }
        
        .logo {
            height: 20px;
            width: auto;
            vertical-align: middle;
            margin-right: 10px;
        }
        
        .logo-large {
            height: 60px;
            width: auto;
            vertical-align: middle;
            margin-right: 15px;
        }
        
        a {
            color: white;
        }
        
        /* Add spacing between data sources and table */
        .data-sources {
            margin-bottom: 30px; /* Increase spacing between data sources and table */
            padding-left: 24px;
            padding-right: 24px;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }
        
        th, td {
            border: none;
            border-right: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px;
            text-align: left;
        }
        
        th {
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            opacity: 0.72; /* Make table header text 0.72 opacity */
        }
        
        td:last-child {
            border-right: none;
        }
        
        th:last-child {
            border-right: none;
        }
        
        th {
            font-weight: bold;
        }
        
        /* Remove left padding from the first column (Ranking) */
        th:first-child,
        td:first-child {
            padding-left: 24px;
        }
        
        .aave-row {
            background-color: #BDBBFF;
            font-weight: bold;
            position: sticky;
            bottom: 0;
            z-index: 100;
            transition: opacity 0.3s ease;
        }
        

        
        .aave-row td {
            background-color: #BDBBFF;
        }
        
        .aave-row.sticky-hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .aave-row.sticky-visible {
            opacity: 1;
        }
        
        .aave-row a {
            cursor: pointer;
            transition: opacity 0.2s ease;
        }
        
        .aave-row a:hover {
            opacity: 0.8;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
        }
        
        .error {
            color: #ff6b6b;
            text-align: center;
            padding: 20px;
            background-color: rgba(255, 107, 107, 0.1);
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .status {
            color: #4ecdc4;
            text-align: center;
            padding: 20px;
            background-color: rgba(78, 205, 196, 0.1);
            border-radius: 8px;
            margin: 10px 0;
        }
        

    </style>
</head>
<body>
    <div class="container">
        <h1>Aave vs Banks</h1>
        <p class="data-sources">Data sources: <a href="https://www.federalreserve.gov/releases/lbr/current/" target="_blank">Federal Reserve Statistical Release</a> | <a href="https://defillama.com/protocol/aave" target="_blank">DeFiLlama AAVE</a></p>
        
        <div id="loading" class="loading">Loading data...</div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="status" class="status" style="display: none;"></div>
        <div id="retry" style="display: none; text-align: center; margin: 20px;">
            <button onclick="retryLoad()" style="padding: 10px 20px; background-color: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: white; border-radius: 5px; cursor: pointer;">Retry Loading AAVE Data</button>
        </div>
        
        <table id="rankingTable">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Name</th>
                    <th>Deposits (USD)</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Data will be populated dynamically -->
            </tbody>
        </table>
    </div>

    <script>
        // Bank data from Federal Reserve
        const banksData = [
            { name: "JPMORGAN CHASE BK NA", assets: 3643099 },
            { name: "BANK OF AMER NA", assets: 2615296 },
            { name: "CITIBANK NA", assets: 1760921 },
            { name: "WELLS FARGO BK NA", assets: 1711028 },
            { name: "U S BK NA", assets: 659191 },
            { name: "GOLDMAN SACHS BK USA", assets: 598460 },
            { name: "PNC BK NA", assets: 549324 },
            { name: "TRUIST BK", assets: 527488 },
            { name: "CAPITAL ONE NA", assets: 490573 },
            { name: "STATE STREET B&TC", assets: 368219 },
            { name: "TD BK NA", assets: 366507 },
            { name: "BANK OF NY MELLON", assets: 356262 },
            { name: "BMO BK NA", assets: 257049 },
            { name: "MORGAN STANLEY BK NA", assets: 234481 },
            { name: "FIRST-CITIZENS B&TC", assets: 228632 },
            { name: "MORGAN STANLEY PRIV BK NA", assets: 223785 },
            { name: "CITIZENS BK NA", assets: 220014 },
            { name: "FIFTH THIRD BK NA", assets: 211921 },
            { name: "MANUFACTURERS & TRADERS TC", assets: 209801 },
            { name: "HUNTINGTON NB", assets: 208159 },
            { name: "AMERICAN EXPRESS NB", assets: 203448 },
            { name: "KEYBANK NA", assets: 185776 },
            { name: "ALLY BK", assets: 182323 },
            { name: "HSBC BK USA NA", assets: 166237 },
            { name: "NORTHERN TC", assets: 164498 },
            { name: "REGIONS BK", assets: 158421 },
            { name: "DISCOVER BK", assets: 145413 },
            { name: "SANTANDER BK NA", assets: 104559 },
            { name: "FLAGSTAR BK NA", assets: 97568 },
            { name: "CITY NB", assets: 93149 },
            { name: "ZIONS BC NA", assets: 87992 },
            { name: "WESTERN ALLI BK", assets: 82944 },
            { name: "FIRST HORIZON BK", assets: 81202 },
            { name: "WEBSTER BK NA", assets: 80212 },
            { name: "COMERICA BK", assets: 77698 },
            { name: "EAST WEST BK", assets: 75712 },
            { name: "UMB BK NA", assets: 69014 },
            { name: "SOUTHSTATE BK NA", assets: 65109 },
            { name: "VALLEY NB", assets: 61818 },
            { name: "CIBC BK USA", assets: 61303 }
        ];

        // Function to fetch AAVE TVL from DeFiLlama
        async function fetchAaveTVL() {
            try {
                console.log('Fetching AAVE TVL from DeFiLlama API...');
                
                // Use the official DeFiLlama API endpoint for AAVE
                const response = await fetch('https://api.llama.fi/protocol/aave');
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('AAVE TVL data received from API:', data);
                    
                    // The API returns current TVL in currentChainTvls
                    if (data.currentChainTvls) {
                        // Sum all non-borrowed chain TVLs to get total current TVL
                        const totalTVL = Object.entries(data.currentChainTvls)
                            .filter(([key, value]) => !key.includes('-borrowed') && typeof value === 'number')
                            .reduce((sum, [key, value]) => sum + value, 0);
                        
                        if (totalTVL > 0) {
                            console.log('Calculated total current TVL:', totalTVL);
                            return totalTVL;
                        }
                    }
                    
                    // Fallback: try to find it in the response
                    if (data.currentChainTvls && data.currentChainTvls.ethereum) {
                        return data.currentChainTvls.ethereum;
                    }
                    
                    throw new Error('TVL data not found in API response');
                } else {
                    throw new Error(`API request failed with status: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Error fetching AAVE TVL from DeFiLlama API:', error);
                
                // Fallback to alternative API endpoints
                console.log('Trying alternative API endpoints...');
                return await fetchAaveTVLFromAlternativeAPIs();
            }
        }
        
        // Fallback function to fetch from alternative DeFiLlama API endpoints
        async function fetchAaveTVLFromAlternativeAPIs() {
            try {
                const endpoints = [
                    'https://api.llama.fi/protocol/aave-v3',
                    'https://api.llama.fi/protocol/aave-v2',
                    'https://api.llama.fi/protocol/aave'
                ];
                
                for (const endpoint of endpoints) {
                    try {
                        console.log(`Trying alternative API endpoint: ${endpoint}`);
                        const response = await fetch(endpoint);
                        
                        if (response.ok) {
                            const data = await response.json();
                            console.log('AAVE TVL data received from alternative API:', data);
                            
                            // Try different possible TVL fields
                            if (data.currentChainTvls) {
                                // Sum all non-borrowed chain TVLs to get total current TVL
                                const totalTVL = Object.entries(data.currentChainTvls)
                                    .filter(([key, value]) => !key.includes('-borrowed') && typeof value === 'number')
                                    .reduce((sum, [key, value]) => sum + value, 0);
                                
                                if (totalTVL > 0) {
                                    console.log('Alternative API - Calculated total current TVL:', totalTVL);
                                    return totalTVL;
                                }
                            }
                            
                            // Fallback: try to find it in the response
                            if (data.currentChainTvls && data.currentChainTvls.ethereum) {
                                return data.currentChainTvls.ethereum;
                            }
                        }
                    } catch (endpointError) {
                        console.log(`Alternative API endpoint ${endpoint} failed:`, endpointError.message);
                        continue;
                    }
                }
                
                throw new Error('All alternative API endpoints failed');
            } catch (error) {
                console.error('Alternative API fallback also failed:', error);
                throw error;
            }
        }



        // Function to format numbers with commas and add B/T suffixes
        function formatNumber(num) {
            if (num >= 1000000000000) {
                // Trillions
                const trillions = (num / 1000000000000).toFixed(3);
                return trillions.replace(/\.?0+$/, '') + 'T';
            } else if (num >= 1000000000) {
                // Billions
                const billions = (num / 1000000000).toFixed(3);
                return billions.replace(/\.?0+$/, '') + 'B';
            } else if (num >= 1000000) {
                // Millions
                const millions = (num / 1000000).toFixed(3);
                return millions.replace(/\.?0+$/, '') + 'M';
            } else {
                // Thousands and below
                return num.toLocaleString();
            }
        }

        // Function to render the table with dynamic ranking
        function renderTable(aaveTVL) {
            const tableBody = document.getElementById('tableBody');
            const loadingDiv = document.getElementById('loading');
            
            // Hide loading
            loadingDiv.style.display = 'none';
            
            // Combine banks and AAVE data
            const allData = [
                ...banksData.map(bank => ({
                    name: bank.name,
                    assets: bank.assets * 1000000 // Convert from millions to full USD value
                })),
                {
                    name: '<svg class="logo" viewBox="0 0 833 139" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M764.174 110.231C746.305 110.231 730.427 97.2842 726.337 79.409H832.43C832.43 79.409 833 72.9322 833 70.641C833 32.7018 802.132 1.82812 764.193 1.82812C726.254 1.82812 695.387 32.6954 695.387 70.641C695.387 108.587 726.081 138.737 764.193 138.737C802.305 138.737 824.558 110.66 830.113 90.3338H797.774C797.774 90.3338 787.489 110.231 764.174 110.231ZM764.193 30.321C781.326 30.321 796.2 41.6362 801.294 58.5002H727.092C732.168 41.6362 747.048 30.321 764.193 30.321Z" fill="#ffffff"/><path d="M359.33 138.737C321.391 138.737 291.631 108.19 291.631 70.641C291.631 33.0922 322.498 1.82812 360.437 1.82812C398.377 1.82812 429.244 33.9114 429.244 70.2762C429.244 85.7706 429.244 135.326 429.244 135.326H402.53V113.617L400.585 113.105C395.881 124.638 378.837 138.737 359.324 138.737H359.33ZM360.437 30.321C339.01 30.321 321.57 48.3114 321.57 70.4298C321.57 92.5482 339.004 110.238 360.437 110.238C381.871 110.238 399.305 92.3818 399.305 70.4298C399.305 48.4778 381.871 30.321 360.437 30.321Z" fill="#ffffff"/><path d="M505.473 138.737C467.533 138.737 437.773 108.19 437.773 70.641C437.773 33.0922 468.641 1.82812 506.58 1.82812C544.519 1.82812 575.386 33.9114 575.386 70.2762C575.386 85.7706 575.386 135.326 575.386 135.326H548.673V113.617L546.727 113.105C542.023 124.638 524.98 138.737 505.466 138.737H505.473ZM506.58 30.321C485.153 30.321 467.713 48.3114 467.713 70.4298C467.713 92.5482 485.146 110.238 506.58 110.238C528.014 110.238 545.447 92.3818 545.447 70.4298C545.447 48.4778 528.014 30.321 506.58 30.321Z" fill="#ffffff"/><path d="M620.231 135.311L565.402 5.25H595.399L635.585 101.058L675.777 5.25H705.767L650.945 135.311H620.231Z" fill="#ffffff"/><path d="M97.5418 138.533C112.461 138.533 124.556 126.438 124.556 111.518C124.556 96.5987 112.461 84.5039 97.5418 84.5039C82.6221 84.5039 70.5273 96.5987 70.5273 111.518C70.5273 126.438 82.6221 138.533 97.5418 138.533Z" fill="#ffffff"/><path d="M168.149 138.533C183.069 138.533 195.164 126.438 195.164 111.518C195.164 96.5987 183.069 84.5039 168.149 84.5039C153.23 84.5039 141.135 126.438 141.135 111.518C141.135 126.438 153.23 138.533 168.149 138.533Z" fill="#ffffff"/><path d="M132.8 0C59.4497 0 -0.0191954 60.6017 4.64786e-06 135.335H33.9264C33.9264 79.3281 77.8433 33.92 132.8 33.92C187.757 33.92 231.674 79.3281 231.674 135.335H265.6C265.613 60.6017 206.144 0 132.8 0Z" fill="#ffffff"/></svg>',
                    assets: aaveTVL // Use full USD value
                }
            ];
            
            // Sort by assets (descending)
            allData.sort((a, b) => b.assets - a.assets);
            
            // Generate table rows
            const tableRows = allData.map((item, index) => {
                // Check if it's the AAVE row by looking for SVG content in the name
                const isAaveRow = item.name.includes('<svg');
                const rowClass = isAaveRow ? 'aave-row' : '';
                
                if (isAaveRow) {
                    // Make AAVE row clickable
                    return `
                        <tr class="${rowClass}">
                            <td>${index + 1}</td>
                            <td><a href="https://aave.com" target="_blank" style="text-decoration: none; color: inherit; display: block;">${item.name}</a></td>
                            <td>${formatNumber(Math.round(item.assets))}</td>
                        </tr>
                    `;
                } else {
                    return `
                        <tr class="${rowClass}">
                            <td>${index + 1}</td>
                            <td>${item.name}</td>
                            <td>${formatNumber(Math.round(item.assets))}</td>
                        </tr>
                    `;
                }
            });
            
            tableBody.innerHTML = tableRows.join('');
            
            // Set up scroll handling for sticky AAVE row
            setupStickyScroll();
        }
        
        // Function to handle sticky scroll behavior for AAVE row
        function setupStickyScroll() {
            const aaveRow = document.querySelector('.aave-row');
            if (!aaveRow) return;
            
            // Get the AAVE row's position relative to the viewport
            const aaveRowRect = aaveRow.getBoundingClientRect();
            const aaveRowTop = aaveRowRect.top + window.pageYOffset;
            
            function handleScroll() {
                const scrollY = window.pageYOffset;
                const viewportHeight = window.innerHeight;
                
                // Calculate when the AAVE row should become sticky
                // It becomes sticky when it's about to go out of view at the bottom
                const shouldBeSticky = scrollY + viewportHeight >= aaveRowTop + aaveRow.offsetHeight;
                
                if (shouldBeSticky) {
                    aaveRow.classList.add('sticky-visible');
                    aaveRow.classList.remove('sticky-hidden');
                } else {
                    aaveRow.classList.add('sticky-hidden');
                    aaveRow.classList.remove('sticky-visible');
                }
            }
            
            // Add scroll event listener
            window.addEventListener('scroll', handleScroll);
            
            // Initial call to set correct state
            handleScroll();
        }

        // Function to handle errors
        function showError(message) {
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const statusDiv = document.getElementById('status');
            const retryDiv = document.getElementById('retry');
            
            loadingDiv.style.display = 'none';
            errorDiv.textContent = `Error: ${message}`;
            errorDiv.style.display = 'block';
            statusDiv.style.display = 'none';
            retryDiv.style.display = 'block';
        }
        
        // Function to show status messages
        function showStatus(message) {
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const statusDiv = document.getElementById('status');
            const retryDiv = document.getElementById('retry');
            
            loadingDiv.style.display = 'none';
            errorDiv.style.display = 'none';
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            retryDiv.style.display = 'block';
        }
        
        // Function to retry loading AAVE data
        function retryLoad() {
            const retryDiv = document.getElementById('retry');
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const statusDiv = document.getElementById('status');
            
            retryDiv.style.display = 'none';
            errorDiv.style.display = 'none';
            statusDiv.style.display = 'none';
            loadingDiv.style.display = 'block';
            
            init();
        }

        // Initialize the page
        async function init() {
            try {
                const aaveTVL = await fetchAaveTVL();
                renderTable(aaveTVL);
            } catch (error) {
                console.error('AAVE TVL fetch failed, trying fallback...');
                // Try to load from local data file as fallback
                try {
                    const response = await fetch('./data/latest.json');
                    if (response.ok) {
                        const data = await response.json();
                        console.log('Using fallback data from local file');
                        // Use a placeholder AAVE TVL value for now
                        const fallbackAaveTVL = 69000000000; // 69 billion USD as fallback (current AAVE TVL)
                        renderTable(fallbackAaveTVL);
                        showStatus('Using fallback AAVE TVL data. API connection failed.');
                    } else {
                        throw new Error('Local data file not accessible');
                    }
                } catch (fallbackError) {
                    console.error('Fallback also failed:', fallbackError);
                    showError('Failed to load AAVE TVL data. Please check your internet connection and try again later.');
                }
            }
        }

        // Start the application
        init();
    </script>
</body>
</html>
